# 社内教育資料の構成

# ねらい
- 誰に
    - 社内SE
    - ★マネージャや営業を含めるか？
- 何を
    - Kubernetesの利点
      - Kubernetesは何を変えるのか
      - どこに効いてくるのか(運用、開発)
- どれくらいの時間で
    - １時間
        - ★１回だけ？　複数回に分ける？
- どこで
    - 社内勉強会
    - 資料公開
    - ハンズオン
    - ★社外向け公開も？
- 何を使って
    - 資料
        - 説明資料
        - ハンズオンの手順資料
    - k8sが動作する環境

---

# 説明資料
## 業界トレンド・動向
### 企業のミッション
- 市場投入までの時間の短縮
- 高い顧客満足度
- 改良された製品の品質
- 改良されて、信頼性の高いリリース
- 改良された生産性・効率
- 迅速な実験によって、適切な製品を構築する能力

- ミッション達成には、ITシステムにおける開発と運用の連携が必要。
    - DevOps
        - DevOpsにはコンテナが親和性高い。
        - IaaSも親和性高いと言われていたが、もっと良い。

### コンテナ技術
- コンテナ技術の特徴
- コンテナ技術が注目された理由
    - 「ほげほげ」なのが特徴でDevOpsにつながるから注目された的な説明。

### CNCF
- 団体の概要
- 開催イベント
- ホストしているプロジェクト

### 企業の動向
- コンテナ技術を使ったサービサーの動向
- コンテナ技術を使ったSIerの動向

## コンテナ説明(Docker)
- 技術説明
    - いわゆる普通のコンテナの説明を書く。kata containerの話は書かない。
    - ★模式図を貼る
    - カーネルが共有されてること
        - 使用リソースが少ない
    - ブートプロセスが必要ないこと
        - 起動が早い
    - アプリケーションコードとライブラリモジュール込みでイメージになっていること。
        - 同一の環境をたくさん作れる。環境差異が生まれない。動くことが保証された環境が作れる。
        - サーバが提供されるIaaSとは違う。根本的にコンテナのターゲットはアプリケーション。サーバではない。
        - オレオレ開発環境は発生しない。
        - 開発環境構築手順書は必要ない。
    - イメージとして管理されており、バージョン管理されている。
        - docker registryとかの話
        - ★イメージの脆弱性チェックの話もいれるか？
        - ★プライベートレジストリの話も入れるか？
    - どこまでカバーしているか(何を自前でやらないといけないか)
        - スケジューラは無いということ
        - ネットワークは面倒見ないということ
        - ストレージは面倒見ないということ
        - 機能としてはコンテナを実行してくれるだけ
            - アプリの設定を変更したいときは独自の手順が必要ということ
            - 言い換えると、アプリケーションの運用まではカバーしていない。
- 利点
    - アプリの開発
        - 動作することが保証された開発環境がすぐに提供される
            - GCPの Google Cloud Shellみたいな既存のサービスもある。本質的にやりたいことにすぐに取り掛かれる体制が必要。
        - 開発環境もバージョン管理されているから、すぐに昔に戻れる
    - 環境の構築
        - ノードの構築が楽。Dockerとか入れておけばOK。
        - 必要なもの(アプリとモジュール)が入ったものを使うことになるため構築手順が簡素になる。
    - 環境の運用
        - 隔離されているから相乗りしてもごちゃごちゃにならない。
        - 違うバージョンのモジュールもコンテナの仕組みで隔離できる。
- 欠点
    - ★なにか書いたほうがいいか。
    - Windowsの対応は遅れている。
    - カーネルのチューニングはやりにくい。

## Kubernetes説明
- 歴史と現状
    - GoogleのBorgがベースになっている
    - コンテナ分野ではほぼほぼデファクトになっている
- 特徴
    - Kubernetes公式の機能説明を書く。
    - Dockerには無い部分がある。
        - スケジューラがある
        - ネットワークはプラグインから選べる
        - ストレージはプラグインから選べる
        - アプリケーションを運用するための機能がはじめから備わっている
            - ConfigSet
            - Secret
            - Service
            - Deployment
            - ReplicaSet
            - ローリングアップデート
    - Docker以上にアプリケーションが中心の基本概念になっている。
        - IaaSとの違い(サーバの提供ではないということ)
    - そもそもアプリケーションがフォーカスされているので、アプリケーション開発者に人気がある。

## これまでと何が変わるか(利点)
- ★既に言っているが、ここで一旦まとめる。
- ★利点をたくさん並べて説明してもわかりづらいので、次ページから操作イメージを説明する。

## Kubernetesの操作イメージ

- ★↓はどこに配置すればいいか。
- 宣言的にアプリケーション環境を定義すれば良い
    - k8sはアプリケーション環境の定義(宣言的な定義)
    - ansibleとかpuppetなどは、デプロイ手順の自動化
    - ★うまく違いを表現できない。
        - 責務が分割されている。12factor的な考え方。
        - k8sとかでは、アプリやモジュールのインストールはコンテナイメージで予め用意
        - イメージに適用する設定値を可変にしてコンテナに流しこめばデプロイが完了する状況になっている
        - ansibleとかはこれらが分かれているわけではない。インストールもできるし設定もできる。
            - 何でもできるが、何でもできるからごちゃごちゃになりやすい。
        - k8sはアプリデプロイ方法のフレームワーク的な役割になっている。
            - Google が社内のアプリケーション運用で考えた仕組みだから当然か。

## 従来の開発、構築、運用との比較

### アプリ開発ー＞基盤構築ー＞デプロイー＞運用のアウトライン
- ★フロー図を貼り付ける

### アプリ開発
- ★ページを左右に分けて従来とk8sの時の違いを表現する
    - アプリ開発の時はk8sならではの違いは無いかな。Dockerを使う時の利点になるか？
- k8s
    - 開発環境の準備が楽
        - サーバがすぐに準備できる
            - DB
            - LB
            - Web
    - 開発用ツールがインストール済みなので楽
        - エディタ
        - ライブラリ
        - ソースコードバージョン管理ツール

### 基盤構築
- k8s
    - OSインストール
    - 各ディストロのk8sパッケージをインストールすれば良い。
    - ApacheやAPPサーバなどのミドルはインストール済みのコンテナイメージがアプリデプロイ時に実行される。
- 従来
    - OSインストール
    - ミドルウェアインストール

### アプリデプロイ
- k8s
    - k8sのコマンドを使って完結。
    - デプロイ手順はk8sのマニフェストに定義されているため、k8sへのマニフェスト登録だけで完了する。
    - この時にミドルインストール済みコンテナが動作する。
- 従来
    - ツール次第
        - 手順書を作成して実行
        - ansible, puppet, chef などで自動化して実行

### 運用

#### 設定変更
- k8s
    - k8sのコマンドを使って完結。
    - ConfigSet, Secret を変更すれば良い
- 従来
    - ツール次第
        - 手順書を作成して実行
        - ansible, puppet, chef などで自動化して実行

#### アップデート
- k8s
    - k8sのコマンドを使って完結。
    - Deployment を変更すれば良い
- 従来
    - ツール次第
        - 手順書を作成して実行
        - ansible, puppet, chef などで自動化して実行


## FAQ



---

# ハンズオンの手順資料
## 手順のアウトライン
## Kubernetes構築
## アプリのデプロイ
## アプリの運用
### 設定変更
### スケールアウト/イン
### アップデート(パッチ適用)
### アップグレード
## アプリの終了
